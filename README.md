# 日本株式分析MCPサーバー v2.0

日本株の**株価分析（テクニカル）**と**企業業績分析（ファンダメンタルズ）**を統合し、短期・中期・長期の投資判断を提供するMCP（Model Context Protocol）サーバーです。

## 新機能（v2.0）

✨ **ファンダメンタルズ分析を追加！**
- PER、PBR、ROE、配当利回りなどの財務指標を自動取得・分析
- バリュエーション、財務健全性、収益性の3軸評価
- テクニカル分析と統合した総合投資判断

## 機能

### 提供ツール

#### 1. 株価分析（テクニカル）

**get_stock_price** - 株価データ取得
- 指定期間の日足データ（始値、高値、安値、終値、出来高）を取得

**analyze_stock** - テクニカル分析
- RSI、MACD、移動平均線などのテクニカル指標を計算
- 短期・中期・長期の投資判断を提供

**get_current_price** - 現在価格取得
- リアルタイムの株価、前日比、変動率を表示

#### 2. 企業業績分析（ファンダメンタルズ）NEW!

**get_fundamentals** - ファンダメンタルズ分析
- 企業の財務データを取得・分析
- **バリュエーション評価**: PER、PBR、配当利回り
- **財務健全性評価**: ROE、負債比率、流動比率
- **収益性評価**: 営業利益率、純利益率、EPS

#### 3. 総合分析（テクニカル × ファンダメンタルズ）NEW!

**analyze_comprehensive** - 総合分析
- テクニカル分析とファンダメンタルズ分析を統合
- 総合スコア（0-100）と推奨レベル（STRONG_BUY/BUY/HOLD/SELL/STRONG_SELL）
- 投資サマリー: 主要なポイントを要約

#### 4. 比較・ランキング

**compare_stocks** - 複数銘柄比較
- 複数銘柄を一括分析
- 短期・中期・長期それぞれでランキング表示

**find_best_stocks** - 最適銘柄検索
- 指定した投資期間で最も有望な銘柄をランキング

## 分析手法

### テクニカル分析

#### 短期分析（1ヶ月以内）
- RSI（買われすぎ・売られすぎ判定）
- MACD（トレンド転換検出）
- 20日移動平均線
- 直近のモメンタム

#### 中期分析（3-6ヶ月）
- 50日移動平均線
- ゴールデンクロス・デッドクロス
- 3ヶ月トレンド分析
- ボラティリティ分析

#### 長期分析（6ヶ月以上）
- 200日移動平均線
- 年間トレンド
- 52週高値・安値との位置関係
- トレンドの一貫性

### ファンダメンタルズ分析

#### バリュエーション分析
- **PER（株価収益率）**: 業種平均15を基準に評価
- **PBR（株価純資産倍率）**: 1.0を基準に評価
- **配当利回り**: 高配当株を評価

#### 財務健全性分析
- **負債比率**: 低いほど健全
- **流動比率**: 短期支払能力の指標
- **ROE（自己資本利益率）**: 資本効率の指標

#### 収益性分析
- **営業利益率**: 本業の収益力
- **純利益率**: 最終的な利益率
- **EPS（1株当たり利益）**: 株主への還元力

### 総合分析（統合アプローチ）

テクニカル分析とファンダメンタルズ分析を50:50で統合し、総合的な投資判断を提供：

- **総合スコア**: 0-100の数値で評価
- **推奨レベル**:
  - STRONG_BUY (75+): 強い買い推奨
  - BUY (60-74): 買い推奨
  - HOLD (40-59): 保留
  - SELL (25-39): 売り推奨
  - STRONG_SELL (<25): 強い売り推奨
- **投資サマリー**: 主要なポイントを箇条書きで要約

## セットアップ

### 前提条件

- **Node.js 18以上** (必須)
- **Python 3.8以上** (ファンダメンタルズ分析を使用する場合に推奨)

### 1. 依存パッケージのインストール

#### 自動セットアップ（推奨）

```bash
cd japan-stock-mcp
./setup.sh
```

このスクリプトは以下を自動実行します:
- Node.js依存パッケージのインストール
- Python依存パッケージ（yfinance）のインストール
- TypeScriptのビルド

#### 手動セットアップ

**Node.js依存パッケージ:**
```bash
npm install
```

**Python依存パッケージ（ファンダメンタルズ分析用）:**
```bash
pip3 install yfinance
# または
pip3 install -r requirements.txt
```

### 2. ビルド

```bash
npm run build
```

### 3. Claude DesktopまたはCline用の設定

#### Claude Desktop の場合

`~/Library/Application Support/Claude/claude_desktop_config.json` (macOS) または
`%APPDATA%\Claude\claude_desktop_config.json` (Windows) に以下を追加:

```json
{
  "mcpServers": {
    "japan-stock": {
      "command": "node",
      "args": ["/絶対パス/japan-stock-mcp/dist/index.js"]
    }
  }
}
```

#### Cline (VS Code拡張) の場合

VS Codeの設定 (settings.json) に以下を追加:

```json
{
  "mcp.servers": {
    "japan-stock": {
      "command": "node",
      "args": ["/絶対パス/japan-stock-mcp/dist/index.js"]
    }
  }
}
```

### 4. サーバーの起動確認

MCPインスペクターでテスト:

```bash
npm run inspector
```

## 使用例

### 1. テクニカル分析のみ

```
トヨタ自動車（7203）をテクニカル分析してください
```

### 2. ファンダメンタルズ分析のみ（NEW!）

```
ソニーグループ（6758）のファンダメンタルズを分析してください
```

### 3. 総合分析（テクニカル + ファンダメンタルズ）（NEW!）

```
ソフトバンクグループ（9984）を総合的に分析してください
```

この分析では以下が表示されます：
- テクニカル分析結果（短期・中期・長期）
- ファンダメンタルズ分析結果（バリュエーション、財務健全性、収益性）
- 総合評価とスコア
- 投資サマリー

### 4. 複数銘柄の比較

```
以下の銘柄を総合的に比較してください:
- 7203（トヨタ自動車）
- 6758（ソニーグループ）
- 9984（ソフトバンクグループ）
```

### 5. 投資期間別の推奨銘柄

```
短期投資で有望な銘柄TOP5を教えてください。
候補: 7203, 6758, 9984, 8306, 9432, 6861, 4063
```

## 主要銘柄コード例

- 7203: トヨタ自動車
- 6758: ソニーグループ
- 9984: ソフトバンクグループ
- 8306: 三菱UFJフィナンシャル・グループ
- 9432: 日本電信電話（NTT）
- 6861: キーエンス
- 4063: 信越化学工業
- 6098: リクルートホールディングス
- 7974: 任天堂
- 4502: 武田薬品工業

詳細は `stock-symbols.md` を参照してください。

## データソース

- **株価データ**: Yahoo Finance API
- **財務データ**: Yahoo Finance API（企業財務情報）

## 技術スタック

- TypeScript
- @modelcontextprotocol/sdk
- axios (HTTPクライアント)
- zod (スキーマバリデーション)

## 開発

### ウォッチモード

```bash
npm run watch
```

### ビルド

```bash
npm run build
```

### インスペクター起動

```bash
npm run inspector
```

## 注意事項

- 本ツールは投資助言を目的としたものではありません
- 投資判断は自己責任で行ってください
- 株価データには遅延が含まれる場合があります
- ファンダメンタルズ分析は利用可能なデータに基づいており、すべての財務情報が取得できるとは限りません

## トラブルシューティング

### "財務データの取得に失敗しました: 401エラー"が表示される

**原因**: Yahoo Finance APIへのアクセスが制限されています。

**解決方法**:
1. **Python + yfinanceをインストール（推奨）**:
   ```bash
   pip3 install yfinance
   ```
   
2. **しばらく待ってから再試行**: APIのレート制限により一時的にブロックされている可能性があります

3. **テクニカル分析のみを使用**: `analyze_stock`ツールは問題なく動作します

詳細は `TROUBLESHOOTING.md` を参照してください。

### Pythonが見つからない

ファンダメンタルズ分析を使用するには、Python 3.8以上が必要です:
- macOS: `brew install python3`
- Ubuntu: `sudo apt install python3 python3-pip`
- Windows: [python.org](https://www.python.org/downloads/)

### yfinanceがインストールできない

```bash
pip3 install yfinance --break-system-packages
```

または

```bash
python3 -m pip install yfinance --user
```

## バージョン履歴

### v2.0 (2024)
- ✨ ファンダメンタルズ分析機能を追加
- ✨ テクニカルとファンダメンタルズの統合分析機能を追加
- 📊 バリュエーション、財務健全性、収益性の評価機能
- 🎯 総合スコアと推奨レベルの提供

### v1.0 (2024)
- 🚀 初回リリース
- テクニカル分析機能（RSI、MACD、移動平均線）
- 短期・中期・長期の投資判断

## ライセンス

MIT
